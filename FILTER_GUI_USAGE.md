# フレームフィルタリングGUI 使用ガイド

## 概要

クラスタリング後、UMAP可視化の前に、抽出された音声フレームをフィルタリングするためのGUIが追加されました。このGUIを使用して、鳥の鳴き声でない音声フレームを手動で除外できます。

## ワークフロー

```
1. ファイル選択ダイアログ
   ↓
2. 音声読み込み
   ↓
3. ハイパスフィルタ適用
   ↓
4. 鳴き声区間の抽出
   ↓
5. スペクトログラム表示
   ↓
6. フレーム分割
   ↓
7. クラスタリング (K-Means)
   ↓
🆕 8. フレームフィルタリングGUI ← ここで手動フィルタリング
   ↓
9. UMAP可視化（フィルタリング後のデータ）
   ↓
10. クラスタごとの代表音保存
   ↓
11. スペクトログラム表示
```

## 機能

### 主要ボタン

1. **▶ 再生** - 現在のフレームを再生します
2. **✗ 除外** - 現在のフレームを除外リストに追加します（鳥の鳴き声でない場合に使用）
3. **→ スキップ** - 除外せずに次のフレームに進みます（鳥の鳴き声として保持する場合に使用）
4. **▶▶ 全再生** - すべてのフレームを順番に自動再生します
5. **■ 停止** - 自動再生を停止します
6. **✓ 完了** - フィルタリングを完了し、UMAP可視化に進みます

## 使用方法

### 基本的なワークフロー

1. WAVファイルを選択し、スクリプトを実行します
2. クラスタリングが完了すると、フィルタリングGUIウィンドウが自動的に表示されます
3. 各フレームに対して以下のいずれかを選択します：
   - **再生**: 音声を聞いて判断します
   - **除外**: 鳥の鳴き声でない場合は除外します
   - **スキップ**: 鳥の鳴き声として保持し、次のフレームに進みます
4. すべてのフレームを確認したら、**完了**ボタンをクリックします
5. フィルタリング後のデータでUMAP可視化が表示されます

### 自動再生モード

すべてのフレームを順番に聞きたい場合：

1. **▶▶ 全再生**ボタンをクリックします
2. フレームが順番に再生されます
3. 停止したい場合は**■ 停止**ボタンをクリックします

### 表示情報

- **フレーム番号**: 現在のフレーム番号と全体のフレーム数
- **時間**: 元の音声ファイル内での時刻（秒）
- **クラスタ**: K-Meansによって割り当てられたクラスタ番号
- **状態**: 現在のフレームが「保持」か「除外済み」か
- **除外済み**: これまでに除外したフレームの総数

## 技術的詳細

### 実装

- GUIはtkinterを使用して実装されています
- 音声再生はsounddeviceライブラリを使用しています
- 再生は別スレッドで実行され、GUIがブロックされません
- フィルタリング結果は後続のUMAP可視化とクラスタ分析に自動的に適用されます

### フィルタリングの影響

除外されたフレームは以下の処理から除外されます：

1. UMAP可視化
2. クラスタごとの代表鳴き声の保存
3. クラスタスペクトログラムの表示

## 注意事項

- フィルタリングは元の音声ファイルを変更しません
- すべてのフレームを確認する必要はありません（スキップ可）
- 完了後は元に戻せないため、慎重に除外してください
- GUIを閉じずに**完了**ボタンを必ず押してください

## トラブルシューティング

### 音声が再生されない

- システムのオーディオ出力が正しく設定されているか確認してください
- sounddeviceライブラリが正しくインストールされているか確認してください

### GUIが表示されない

- tkinterがシステムにインストールされているか確認してください
- Pythonの実行環境がGUIをサポートしているか確認してください

### フレーム数が多すぎる

- 全再生モードを使用すると効率的です
- 除外が必要なフレームのみを選択的に除外できます
- すべてのフレームを確認する必要はありません
