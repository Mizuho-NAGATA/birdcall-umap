# Bird Call Preprocessing GUI - 使用方法

## GUI概要

このGUIツールは、鳥の鳴き声の前処理を視覚的に確認しながら実行できるツールです。

## ウィンドウレイアウト

```
┌─────────────────────────────────────────────────────────────────────────┐
│ Bird Call Preprocessing - Audio Processing GUI                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│ ┌─ ファイル選択 ─────────────────────────────────────────────────────┐ │
│ │  ファイル: example.wav            [WAVファイルを選択]              │ │
│ └────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ ┌─ 前処理パラメータ ───┐  ┌─ 処理状況 ─────────────────────────────┐ │
│ │                      │  │                                         │ │
│ │ ハイパスフィルタ:    │  │ ファイルを読み込んでいます...         │ │
│ │   3000 Hz           │  │ 読み込み完了: 30.5秒                   │ │
│ │                      │  │ ================================================ │ │
│ │ 音声検出閾値:        │  │ 音声処理を開始します...               │ │
│ │   45 dB             │  │ ハイパスフィルタを適用中...           │ │
│ │                      │  │ 音声区間を検出中...                    │ │
│ │ 最小音声長:          │  │ 初期検出: 125区間                      │ │
│ │   0.1 秒            │  │ 非鳥類音声をフィルタリング中...       │ │
│ │                      │  │ フィルタリング後: 87区間               │ │
│ │ スペクトル重心:      │  │                                         │ │
│ │   2500 Hz           │  │ 処理完了:                               │ │
│ │                      │  │   総時間: 30.5秒                        │ │
│ │ ゼロ交差率:          │  │   残された時間: 17.4秒 (57.0%)        │ │
│ │   0.1               │  │   カットされた時間: 13.1秒 (43.0%)    │ │
│ │                      │  │                                         │ │
│ │ RMSエネルギー:       │  │                                         │ │
│ │   0.005             │  │                                         │ │
│ │                      │  │                                         │ │
│ │ スペクトルロールオフ: │  │                                         │ │
│ │   3500 Hz           │  │                                         │ │
│ │                      │  │                                         │ │
│ │ ┌───────────────────┐ │  │                                         │ │
│ │ │ 音声を処理         │ │  │                                         │ │
│ │ └───────────────────┘ │  │                                         │ │
│ │ ┌───────────────────┐ │  │                                         │ │
│ │ │処理後の音声を再生  │ │  │                                         │ │
│ │ └───────────────────┘ │  │                                         │ │
│ │ ┌───────────────────┐ │  │                                         │ │
│ │ │ 可視化を開始       │ │  │                                         │ │
│ │ └───────────────────┘ │  │                                         │ │
│ └──────────────────────┘  └─────────────────────────────────────────┘ │
│                                                                         │
│ ┌─ 波形表示 ──────────────────────────────────────────────────────────┐ │
│ │                     処理後の音声                                    │ │
│ │  1.0┤                                                               │ │
│ │     │    ▄▄▄▄         ▄▄▄     ▄▄▄▄▄       ▄▄▄                    │ │
│ │  0.5┤   ▐████▌       ▐███▌   ▐█████▌     ▐███▌                   │ │
│ │     │  ▐██████▌     ▐█████▌ ▐███████▌   ▐█████▌                  │ │
│ │  0.0┼──▐██████▌─────▐█████▌─▐███████▌───▐█████▌──────────────────│ │
│ │     │  ▐██████▌     ▐█████▌ ▐███████▌   ▐█████▌                  │ │
│ │ -0.5┤   ▐████▌       ▐███▌   ▐█████▌     ▐███▌                   │ │
│ │     │    ▀▀▀▀         ▀▀▀     ▀▀▀▀▀       ▀▀▀                    │ │
│ │ -1.0┤                                                               │ │
│ │     └──────────────────────────────────────────────────────────── │ │
│ │                          時間 (秒)                                  │ │
│ │                                                                     │ │
│ │   青色 = 残された部分（鳥の鳴き声）                                 │ │
│ │   灰色 = カットされた部分（ノイズ・無音）                           │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
```

## 主な機能説明

### 1. ファイル選択
- 「WAVファイルを選択」ボタンをクリックして音声ファイルを読み込みます
- 読み込まれたファイル名が表示されます
- 元の波形が自動的に表示されます

### 2. パラメータ調整
以下のパラメータを調整できます：

- **ハイパスフィルタ (Hz)**: この周波数未満の音をカット（デフォルト: 3000Hz）
- **音声検出閾値 (top_db)**: 音声と無音を判定する閾値（デフォルト: 45dB）
- **最小音声長 (秒)**: この長さ未満の音声はノイズとして除外（デフォルト: 0.1秒）
- **スペクトル重心 (Hz)**: 周波数の重心がこの値未満は除外（デフォルト: 2500Hz）
- **ゼロ交差率**: この値未満は持続的な低音として除外（デフォルト: 0.1）
- **RMSエネルギー**: この値未満はノイズレベルとして除外（デフォルト: 0.005）
- **スペクトルロールオフ (Hz)**: この値未満は低周波ノイズとして除外（デフォルト: 3500Hz）

### 3. 音声を処理
- パラメータに基づいて音声を前処理します
- 処理の進行状況が「処理状況」エリアに表示されます
- 処理後、波形表示エリアに結果が表示されます
  - 青色: 残された部分（鳥の鳴き声として検出）
  - 灰色: カットされた部分（ノイズや無音として除外）

### 4. 処理後の音声を再生
- 処理後の音声を実際に聞いて確認できます
- 再生中はボタンが無効化されます
- 再生が終了すると自動的にボタンが再び有効になります

### 5. パラメータの再調整と再処理
- 結果が満足できない場合：
  - パラメータを調整
  - 再度「音声を処理」ボタンをクリック
  - 新しい結果を確認
- 満足いくまで何度でも調整可能

### 6. 可視化を開始
- 満足のいく前処理ができたら、このボタンをクリック
- 確認ダイアログが表示されます
- 次のステップとして `nakigoe.py` を実行して可視化を行います

## 使用例

### 典型的なワークフロー

1. **初回処理**
   ```
   1. WAVファイルを選択
   2. デフォルトパラメータで「音声を処理」
   3. 「処理後の音声を再生」で確認
   ```

2. **ノイズが多い場合**
   ```
   - 音声検出閾値を上げる（例: 45 → 50）
   - スペクトル重心を上げる（例: 2500 → 3000）
   - 再処理して確認
   ```

3. **音声が切れすぎる場合**
   ```
   - 音声検出閾値を下げる（例: 45 → 40）
   - 最小音声長を短くする（例: 0.1 → 0.05）
   - 再処理して確認
   ```

4. **満足したら**
   ```
   - 「可視化を開始」をクリック
   - 次に nakigoe.py を実行
   ```

## トラブルシューティング

### 音声が再生されない
- PortAudioライブラリがインストールされているか確認
- システムのオーディオ設定を確認

### パラメータがわからない
- まずデフォルト値で試してみる
- 結果を見ながら少しずつ調整
- README.mdの技術解説も参照

### エラーが出る
- 処理状況エリアにエラーメッセージが表示されます
- ファイル形式がWAVであることを確認
- ファイルが破損していないか確認
